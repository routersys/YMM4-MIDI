<UserControl x:Class="MIDI.Shape.MidiPianoRoll.Views.EffectSelector"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:effects="clr-namespace:MIDI.Shape.MidiPianoRoll.Effects"
             xmlns:localviews="clr-namespace:MIDI.Shape.MidiPianoRoll.Views"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="400"
             DataContext="{Binding RelativeSource={RelativeSource Self}}">

    <UserControl.Resources>
        <ResourceDictionary>
            <Style x:Key="ToolButtonStyle" TargetType="Button">
                <Setter Property="Width" Value="24"/>
                <Setter Property="Height" Value="24"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="4"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter x:Name="contentPresenter"
                                                  Content="{TemplateBinding Content}"
                                                  Focusable="False"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  Margin="{TemplateBinding Padding}"
                                                  RecognizesAccessKey="True"
                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="border" Property="Opacity" Value="0.56"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Path x:Key="IconPlus" Data="M 4 0 V 4 H 0 V 5 H 4 V 9 H 5 V 5 H 9 V 4 H 5 V 0 Z" Fill="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Stretch="Uniform" />
            <Path x:Key="IconMinus" Data="M 0 4 V 5 H 9 V 4 Z" Fill="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Stretch="Uniform" />
            <Path x:Key="IconUp" Data="M 4.5 0 L 0 5 H 3 V 9 H 6 V 5 H 9 Z" Fill="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Stretch="Uniform" />
            <Path x:Key="IconDown" Data="M 4.5 9 L 0 4 H 3 V 0 H 6 V 4 H 9 Z" Fill="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Stretch="Uniform" />
            <Path x:Key="IconReload" Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" Fill="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Stretch="Uniform" />

            <DataTemplate DataType="{x:Type effects:EffectParameterBase}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,5,0" />
                    <TextBlock Grid.Column="1" Text="{Binding EffectName}" ToolTip="{Binding EffectName}" Margin="2" VerticalAlignment="Center" />
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" MinHeight="60" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" MinHeight="150" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <Border Grid.Row="0" Grid.Column="0" BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" BorderThickness="1">
            <ListBox x:Name="EffectListBox"
                     ItemsSource="{Binding ItemsSource}"
                     SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                     Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                     BorderThickness="0" />
        </Border>

        <StackPanel Grid.Row="0" Grid.Column="1" Margin="0" VerticalAlignment="Top">
            <Button x:Name="AddButton" Style="{StaticResource ToolButtonStyle}" Click="AddButton_Click" ToolTip="エフェクトを追加">
                <ContentControl Content="{StaticResource IconPlus}" />
            </Button>
            <Button x:Name="RemoveButton" Style="{StaticResource ToolButtonStyle}" Click="RemoveButton_Click" ToolTip="選択したエフェクトを削除" Margin="0">
                <ContentControl Content="{StaticResource IconMinus}" />
            </Button>
            <Button x:Name="MoveUpButton" Style="{StaticResource ToolButtonStyle}" Click="MoveUpButton_Click" ToolTip="上に移動" Margin="0">
                <ContentControl Content="{StaticResource IconUp}" />
            </Button>
            <Button x:Name="MoveDownButton" Style="{StaticResource ToolButtonStyle}" Click="MoveDownButton_Click" ToolTip="下に移動" Margin="0">
                <ContentControl Content="{StaticResource IconDown}" />
            </Button>
            <Button x:Name="ReloadButton" Style="{StaticResource ToolButtonStyle}" Click="ReloadButton_Click" ToolTip="エフェクトをリロード" Margin="0">
                <ContentControl Content="{StaticResource IconReload}" />
            </Button>
        </StackPanel>

        <Popup x:Name="AddEffectPopupContainer" 
               PlacementTarget="{Binding ElementName=AddButton}" 
               Placement="Bottom" 
               StaysOpen="False"
               AllowsTransparency="True"
               Closed="AddEffectPopupContainer_Closed">
        </Popup>

        <GridSplitter Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                      Height="4" HorizontalAlignment="Stretch" Background="Transparent" 
                      ResizeBehavior="PreviousAndNext" />

        <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                BorderBrush="Transparent" 
                BorderThickness="0" Margin="0,5,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <localviews:DynamicPropertyPanel ItemsSource="{Binding SelectedItem, ElementName=EffectListBox}" />
            </ScrollViewer>
        </Border>

    </Grid>
</UserControl>