# MIDI ファイル読み込みプラグイン for YMM4

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![.NET](https://img.shields.io/badge/.NET-9.0-purple.svg)](#)
[![Release](https://img.shields.io/github/v/release/routersys/YMM4-MIDI.svg)](https://github.com/routersys/YMM4-MIDI/releases)

YMM4（YukkuriMovieMaker v4）で、MIDIファイル（`.mid`, `.midi`）を音声アイテムとして読み込めるようにするファイルソースプラグインです。

![image](https://github.com/routersys/YMM4-MIDI/blob/main/MIDI.png)

---

### 概要

このプラグインを導入すると、MIDIファイルをタイムラインに直接ドラッグ＆ドロップするだけで、音声アイテムとして利用できるようになります。同梱されているSoundFontファイル（`GeneralUser-GS.sf2`）を使ってMIDIを音声に変換（シンセサイズ）するため、豊かな楽器の音色で再生することが可能です。

もしSoundFontファイルが見つからない場合は、代替機能として簡易的な正弦波で音を鳴らします。

### 主な機能

- **MIDIファイルのサポート**:
    - `.mid`および`.midi`形式のファイルを音声アイテムとしてタイムラインに追加できます。

- **SoundFontによるシンセサイズ**:
    - プラグインと同じフォルダ内にある`.sf2`ファイル（SoundFont）を自動で読み込み、高品質な音源でMIDIをレンダリングします。
    - デフォルトで高音質な`GeneralUser-GS.sf2`を同梱しています。
    - お好みのSoundFontファイルに入れ替えて、音色をカスタマイズすることも可能です。

- **フォールバック機能**:
    - `.sf2`ファイルが見つからない場合でも、純粋な正弦波（サイン波）を生成してMIDIを再生します。

---

### 導入方法

1. **[リリースページ](https://github.com/routersys/YMM4-MIDI/releases)** から最新版の `.ymme` ファイルをダウンロードします。
2. ダウンロードしたファイルを実行（ダブルクリック）してインストールを開始します。
3. YMM4にプラグインが登録され、インストール完了です。

### 使い方
1. タイムラインに音声ファイルとして`.mid`または`.midi`ファイルをドラッグ＆ドロップします。
2. または、「音声アイテム」からMIDIファイルを読み込みます。
> [!NOTE]
> ファイル選択ダイアログでMIDIファイルが表示されない場合は、右下のファイル形式フィルターを「すべてのファイル (*.*)」に変更してください。

> [!IMPORTANT]
> YMM4の設定にある"ファイル"に音声 MIDI,MIDを追加してください。
3. ファイルが自動的に音声アイテムとしてタイムラインに追加され、再生できるようになります。

### 免責事項

このプラグインを使用したことによって生じた、いかなる損害についても作者は責任を負いません。自己責任でご利用ください。

### クレジット
GeneralUser GS v2.0.1使用
   - 作者：S. Christian Collins
   - ウェブサイト：http://www.schristiancollins.com
sfizz - BSD 2-Clause License

### リリースノート
[2025/09/15] v2.0.0
- **[追加] SFZ音源への対応**:
  - 高品質なサンプルベース音源フォーマット「SFZ」の再生に完全対応しました。
  - 外部ライブラリ「sfizz」を利用し、安定したレンダリングを実現します。
- **[追加] 専用設定UIの実装**:
  - これまで手動でのJSON編集が必要だった設定を、グラフィカルなUIから変更できるようになりました。
- **[追加] 高度なオーディオエフェクト機能**:
  - マスター出力に対し、コンプレッサー、グローバルリバーブ、イコライザーを適用できるようになりました。
  - 各インストゥルメントに対し、コーラスエフェクトを適用できるようになりました。
- **[追加] 動的な音色変化への対応**:
  - 演奏中に音色をリアルタイムに変更するため、コントロールチェンジ(CC) 71, 72, 73, 74, 75番の処理に対応しました。
- **[追加] パフォーマンス設定**:
  - バッファサイズ、並列処理、最大同時発音数などをユーザーが任意に設定できるようになりました。
- **[追加] デバッグログ出力機能**:
  - プラグインの動作状況やエラーをテキストファイルに出力する機能を追加しました。
- **[修正] 内部アーキテクチャの刷新**:
  - 単一ファイルに実装されていた全機能を、責務ごとにファイルを分割（リファクタリング）し、保守性と拡張性を大幅に向上させました。
- **[修正] 設定管理システムの強化**:
  - 設定の読み込み・保存処理を強化し、旧バージョンの設定ファイルを自動で新しい形式に変換する後方互換処理を実装しました。
- **[修正] MIDIイベント処理の安定性向上**:
  - MIDIイベントを構造化データとして扱う専用クラスを導入し、処理の信頼性を向上させました。
- **[修正] 内蔵シンセサイザーの機能改善**:
  - ローパス、ハイパス、バンドパスの3種類のフィルターを追加し、より多彩な音作りが可能になりました。
- **[修正] オーディオレンダリングの効率化**:
  - SFZ音源と内蔵シンセサイザーの切り替えや音声生成のプロセスを統括するクラスを新設し、処理フローを最適化しました。

[2025/08/30] v1.0.0
- 初回リリース。
